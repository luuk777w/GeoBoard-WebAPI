"use strict";function afterInit(){console.log("App init done"),App.Router.init()}var App=function(){var t={apiUrl:"URL"};return{init:function(n){console.log(t.apiUrl),n()},configMap:t}}();App.Authorize=function(){var t=function(){console.log("Authorize")},n=function(t,n){return $.ajax({type:"post",url:"".concat(App.configMap.apiUrl,"/account/requestOTP/"),data:'{"username": "'.concat(t,'", "password": "').concat(n,'"}'),contentType:"application/json"})},e=function(t,n,e){return $.ajax({type:"post",url:"".concat(App.configMap.apiUrl,"/account/authorize/"),data:'{"username": "'.concat(t,'", "password": "').concat(n,'", "OTP": ').concat(e,"}"),contentType:"application/json"})},o=function(t,n,e){return $.ajax({type:"post",url:"".concat(App.configMap.apiUrl,"/account/register/"),data:'{"username": "'.concat(t,'", "password": "').concat(e,'", "email": "').concat(n,'"}'),contentType:"application/json"})},a=function(t){return $.ajax({type:"post",url:"".concat(App.configMap.apiUrl,"/account/RequestPasswordReset/"),data:'{"username": "'.concat(t,'"}'),contentType:"application/json"})},r=function(t,n,e){return $.ajax({type:"post",url:"".concat(App.configMap.apiUrl,"/account/ResetPassword/"),data:'{"token": "'.concat(e,'", "password": "').concat(n,'", "email": "').concat(t,'"}'),contentType:"application/json"})};return{init:t,RequestOTP:n,Login:e,HasRole:function(t){return App.JWT.getRole()==t},IsLoggedIn:function(){return null!=App.JWT.getRole()&&""!=App.JWT.getRole()},Register:o,RequestPasswordReset:a,ResetPassword:r}}(),App.Helpers=function(){return{init:function(){console.log("Helpers")},redirect:function(t){t!=location.pathname&&(window.history.pushState("","",t),App.Router.resolveRoute())},sanitize:function(t){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},e=/[&<>"'/]/gi;return t.replace(e,function(t){return n[t]})},decode:function(t){return(new DOMParser).parseFromString("<!doctype html><body>"+t,"text/html").body.textContent}}}(),App.JWT=function(){var t=function(){console.log("JWT")},n=function(t){localStorage.setItem("token",t)},e=function(){return localStorage.getItem("token")},o=function(){localStorage.setItem("token","")},a=function(){var t=e();if(null!=t&&""!=t){var n=t.split(".")[1],o=n.replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(o).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}};return{init:t,set:n,get:e,parse:a,getRole:function(){var t=a();return null==t||""==t?[]:t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]},clear:o,getId:function(){var t=a();return null==t||""==t?[]:t.nameid}}}(),App.Router=function(){var t={},n=function(){console.log("routing the shizzles")},e=function(n,e,o){t[n]={controller:e,role:o}},o=null;return{init:n,route:e,resolveRoute:function(){o=o||document.getElementById("view");var n=location.pathname||"/",e=t[n];o&&e?"anonymous"==e.role&&0==App.Authorize.IsLoggedIn()?App[e.controller].init():!App.Authorize.HasRole(e.role)&&null!=e.role||"anonymous"==e.role?0==App.Authorize.IsLoggedIn()?App.Helpers.redirect("/login"):"anonymous"==e.role&&App.Authorize.IsLoggedIn()?App.Helpers.redirect("/home"):App.Error.init("401","Unauthorized."):App[e.controller].init():App.Error.init("404","page not found.")}}}(),App.Router.route("/login","Login","anonymous"),App.Router.route("/","Home","User"),App.Router.route("/home","Home","User"),App.Template=function(){var t={layout:"base_layout"},n=function(){console.log("init template")},e=function(t){},o=function(t,n){return App.Templates[t](n)},a=function(n){if("function"!=typeof App.Templates[n])throw new Error("Layout does not exist.");t.layout=n};return{init:n,getTemplate:e,parse:o,loadhtml:function(n,e){if("function"!=typeof App.Templates[n])throw new Error("Template does not exist.");Handlebars.registerPartial("body",App.Templates[n](e)),document.getElementById("view").innerHTML=App.Templates[t.layout](),$("#view").removeClass(),$("#view").addClass("".concat(n,"-view"))},setLayout:a}}(),App.XHR=function(){var t=function(){console.log("XHR")},n=function(t){return $.ajax({type:"get",url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},e=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return $.ajax({type:"post",data:n,url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},o=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return $.ajax({type:"put",data:n,url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},a=function(t){return $.ajax({type:"delete",url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})};return{init:t,getWithAuthorization:function(t){return $.ajax({type:"get",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+App.JWT.get())},url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},postWithAuthorization:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return $.ajax({type:"post",data:n,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+App.JWT.get())},url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},putWithAuthorization:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return $.ajax({type:"put",data:n,beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+App.JWT.get())},url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},deleteWithAuthorization:function(t){return $.ajax({type:"delete",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+App.JWT.get())},url:"".concat(App.configMap.apiUrl).concat(t),contentType:"application/json"})},get:n,post:e,put:o,del:a}}(),App.Error=function(){return{init:function(t,n){console.log("Error!!"),App.Template.setLayout("base_layout"),App.Template.loadhtml("error",{error_code:t,error_message:n})}}}(),App.Home=function(){return{init:function(){console.log("home"),App.Template.setLayout("base_layout"),App.Template.loadhtml("home")}}}(),App.Login=function(){return{init:function(){console.log("login"),App.Template.setLayout("base_layout"),App.Template.loadhtml("login")}}}();